<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Endless Complexity</title>
    <link rel="stylesheet" href="style.css"/>
    <script defer src="Model.js"></script>
    <script defer src="View.js"></script>
    <script defer src="Fight Event.js"></script>

</head>
<body>
    <div id="app"></div>
</body>

<script>

    //Controller

    //Called from selectEvent() function - Returns a treasure event based on random logic.
    function randomTreasureEvent() {
        //Pick a treasure event at random
        const random = Math.ceil(Math.random() * 10);
        if (round == 10) return castle;
        else return forest;

    }

    //Called from selectEvent() function - Returns a monster based on random logic.
    function randomMonster() {
        //Reset all monster health
        goblin.health = 30 + Math.ceil(Math.random()*30);
        goblinBoss.health = 60 + Math.ceil(Math.random()*60);

        //Pick monster at random
        random = Math.ceil(Math.random() * 10);
        if (round == 10 || round == 20 || round == 30) return goblinBoss;
        if (random == 10 && round > 10) return goblinBoss;
        else return goblin;
    }

    //Called from onclick event in "fight" box.
    function selectEvent(event) {
        //Prevents two events running at the same time - eventTime returns to true at the end of each event.
        if (eventTime == false) return;
        eventTime = false;

        //Increases round by 1 and resets the player's health so they can fight.
        round += 1;
        player.health = 100;

        //Loading event visible on screen
        status = 'Loading event...';
        updateView();

        if (event == "Rest" && player.health < 50) {
            status = 'You take a couple days off to rest, recovering from your wounds.';
            round +=2;
            updateView();
            setTimeout(()=>{status='You are home.';player.health = 100;updateView();eventTime=true;}, 3000);
        }

        //Checks what box was clicked and selects appropriate event
        if (event == 'Fight') {
            setTimeout(()=>{fightSequence(randomMonster());eventTime=true;}, 500);

        }
        else if (event == 'Explore') {
                status = 'Event is not finished, try again later.'
                updateView()
                setTimeout(()=>{status='You are home.';updateView();eventTime=true;}, 3000);

        }
        else if (event == 'Farm') {
                status = 'Event is not finished, try again later.'
                updateView()
                setTimeout(()=>{status='You are home.';updateView();eventTime=true;}, 3000);

        }
        else if (event == 'Study') {
                status = 'Event is not finished, try again later.'
                updateView()
                setTimeout(()=>{status='You are home.';updateView();eventTime=true;}, 3000);

        }
    }

    //Called from 50gp button in the bottom left box.
    function buystrengthPotion() {
        console.log(player.bag.strengthPotion);
        if (player.bag.gold >= 50 && player.bag.inventory > 0) {
            player.bag.gold -= 50;
            player.bag.inventory -= 1;
            player.bag.strengthPotion += 1;
            updateView();
        }
        else alert("Check if you have enough gold or inventory space.");

    }

    function buyHealthPotion() {
        console.log(player.bag.healthpotions);
        if (player.bag.gold >= 25 && player.bag.inventory > 0) {
            player.bag.gold -= 25;
            player.bag.inventory -= 1;
            player.bag.healthpotions += 1;
            updateView();
        }
        else alert("Check if you have enough gold or inventory space.");
    }

    function checkDead() {
        if (player.health < 1) {
            death();
            return;
        }

        if (currentMonster.health < 1) {
            reward();
            return;
        }

    }

    function reset() {
        status = 'You are home.';
        winOrLose = '';
        eventTime = true;

        firstAction = `<button class="actionButton" onclick="selectEvent('Fight')">Fight</button>`;
        secondAction = `<button class="actionButton" onclick="selectEvent('Explore')">Explore</button>`;
        thirdAction = `<button class="actionButton" onclick="selectEvent('Farm')">Farm</button>`;
        fourthAction = `<button class="actionButton" onclick="selectEvent('Study')">Study</button>`;

        player.health = 100;
        player.ad = 7;
        currentMonster = {name:'N/A',health:'N/A'};
        updateView();
    }

    function eventLock() {
        if (strikeTime == false) return "locked";
        strikeTime = false;
        if (bagTime == false) return "locked";
        bagTime = false;
        if (assessTime == false) return "locked";
        assessTime = false;
        if (fleeTime == false) return "locked";
        fleeTime = false;
    }
</script>
</html>
